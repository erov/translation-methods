# Лабораторная работа \#2

## 1. Разработка грамматики

> Вариант 11. Описание массивов в Kotlin
> 
> Массив в Kotlin. Описание начинается ключевым словом “var”, далее идет имя массива, двоеточие, имя типа “Array”, далее в угловых скобках имя типа элементов массива.
> Используйте один терминал для всех имен переменных и имен типов.
> Используйте один терминал для ключевого слова var (не несколько ‘v’, ‘a’, ‘r’).
>
> Пример: var x: Array<Int>;
> 
> Модификация: помимо Array может быть Map.

Грамматика:
```
D -> keyword name : G ;
G -> array < T >
G -> map < T , T >
T -> name
T -> G
```
Где:
  * ```D``` -- нетерминал, соотвествует полностью заданному описанию массива.
  * ```T``` -- нетерминал, соотвествует названию типа, либо параметризации массива/мапы.
  * ```G``` -- нетерминал, соответствуют generic-классу (Array/Map)
  * ```keyword (KEYWORD)``` -- терминал, задает ключевое слово, в данной работе -- только ```"var"```.
  * ```name (NAME)``` -- терминал, задает либо имя переменной, либо имя типа, кроме имени типа ```Array```.
  * ```: (COLON)``` -- терминал, задает символ двоеточия.
  * ```array (ARRAY)``` -- терминал, задает имя типа Array, и только его.
  * ```map (MAP)``` -- терминал, задает имя типа Map, и только его.
  * ```, (COMMA)``` -- терминал, задает символ запятой.
  * ```< (LANGLE)``` -- терминал, задает символ левой треугольной скобки.
  * ```> (RANGLE)``` -- терминал, задает символ правой треугольной скобки.
  * ```; (SEMICOLON)``` -- терминал, задает символ точки с запятой.

В этой грамматике нет ни левой рекурсии, ни правого ветвления. Однако в первоначальном варианте, я рассматривал терминалы ```name``` и ```Array``` как один, из-за чего появлялось правое ветвление, но и как следствие, некоторая бесмысслица в обозначении.

## 2.  Построение лексического анализатора
  
Жадно набирает символы, пока не встретит пробел, конец строки, либо один из специальных символых, которыми не могут быть названы имена типов и переменных в Kotlin -- ```,;[]/<>:\```. После определит соотвествующий токен для выделенной строки. (```"var"``` -- это токен ```keyword```, ```"Array"``` -- это токен ```array```, ```"Map"``` -- это токен ```map```, аналогично строки соответствующие односимвольным токенам грамматики.

[Код лексического анализатора](KotlinArray/lexical-analyzer/) 
  
## 3. Построение синтаксического анализатора

Множества FIRST и FOLLOW для нетерминалов грамматики:
| | FIRST | FOLLOW |
|-|-|-|
|D| KEYWORD | END |
|G| MAP ARRAY | RANGLE COMMA SEMICOLON |
|T| ARRAY MAP NAME | COMMA RANGLE |

[Код, считающий эти множества](KotlinArray/helpers/)
  
## 4. Визуализация дерева разбора

[Код парсера](KotlinArray/parser/)

Для визуализации дерева разбора возпользовался тулзой GraphViz. Добавил в класс дерева метод [walkthroughGraphViz](KotlinArray/parser/Tree.cpp#L44), который генерирует конфиг нужного формата, для запуска. С помощью [скрипта](KotlinArray/visualizer/build_graph.sh) можно получить svg файл:

Пример разбора строки ```var array: Array<Array<Map<Int, Map<String, Array<Double>>>>>;```:

![alt text](KotlinArray/visualizer/output.svg)
  
## 5. Подготовка набора тестов
  
Upd.: тесты были корректны для версии без модификации.
25 корректных и неккоректных тестов с комментариями [здесь](KotlinArray/tests.cpp#L79).
